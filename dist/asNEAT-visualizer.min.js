/* asNEAT-visualizer 0.0.5 2014-04-30 */
define("asNEAT/asNEAT-visualizer",["asNEAT/visualization","asNEAT/forceVisualization","exports"],function(a,b,c){"use strict";var d=a["default"],e=b["default"],f={};f.createVisualization=function(a){return new d(a)},f.createForceVisualization=function(a){return new e(a)},c["default"]=f}),define("asNEAT/forceVisualization",["exports"],function(a){"use strict";function b(a){return"<div><b>"+a.name+"</b> ("+a.id+")<br>"+_.reduce(a,function(a,b,d){return"name"===d||"id"===d?a:a+d+": "+(_.isNumber(b)?c(b)?b:b.toFixed(3):b)+"<br>"},"")+"</div>"}function c(a){return+a===a&&!(a%1)}function d(a){return a.replace(/[a-z]/g,"")}var e=require("asNEAT/nodes/oscillatorNode")["default"],f=require("asNEAT/nodes/noteOscillatorNode")["default"],g=require("asNEAT/nodes/outNode")["default"],h=require("asNEAT/vNode")["default"],i=require("asNEAT/vConnection")["default"],j=(require("asNEAT/graph")["default"],function(a){_.defaults(this,a,this.defaultParameters);var b=this,c=d3.select(this.selector).append("svg").attr("width",this.width).attr("height",this.height).attr("pointer-events","all"),d=c.append("g").call(d3.behavior.zoom().on("zoom",function(){e.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")})),e=c.append("g");d.append("rect").attr("class","draggableRect").attr("fill","rgba(1,1,1,0)"),e.append("g").attr("class","connections"),e.append("g").attr("class","labels"),e.append("g").attr("class","nodes"),e.append("foreignObject").attr("class","parameterToolTip").attr("width",240).attr("height",500).append("xhtml:body").style({display:"none",font:"14px 'Helvetica Neue'","border-radius":"5px",background:"rgba(180, 180, 180, 0.9)",margin:"10px",padding:"5px"}),this.svg=c,this.g=e;var f=e.append("defs");f.selectAll("marker").data(["enabled","disabled"]).enter().append("marker").attr("id",function(a){return a}).attr("viewBox","0 -5 10 10").attr("refX",20).attr("refY",0).attr("markerWidth",3).attr("markerHeight",3).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5");var g=f.append("filter").attr("id","highlight").attr("height","200%").attr("width","200%").attr("x","-50%").attr("y","-50%");g.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",2).attr("result","blur"),g.append("feColorMatrix").attr("in","blur").attr("type","matrix").attr("values","0 0 0 0 1  0 0 0 0 0.522  0 0 0 0 0.106  0 0 0 4 0").attr("result","coloredBlur");var h=g.append("feMerge");h.append("feMergeNode").attr("in","coloredBlur"),h.append("feMergeNode").attr("in","SourceGraphic"),this.vNodes=[],this.vConnections=[],this.forceLayout=null,this.start(),this.refresh();var i=window.onresize;window.onresize=function(){b.refresh(),i&&i()}});j.prototype.defaultParameters={network:null,width:"100%",height:600,selector:".forceNetwork",animateSpeed:750},j.prototype.updateVisualizationNetwork=function(){var a=this.vNodes,b=this.vConnections;_.forEach(this.network.nodes,function(b){var c=_.find(a,{asNEATNode:b});c||a.push(h.createVNodeFrom(b))}),_.forEach(this.network.connections,function(c){var d=_.find(b,{asNEATConnection:c});if(!d){var e=_.findIndex(a,{asNEATNode:c.sourceNode}),f=a[e],g=_.findIndex(a,{asNEATNode:c.targetNode}),h=a[g];b.push(new i({source:f,target:h,asNEATConnection:c}))}})},j.prototype.getRect=function(){return this.svg[0][0].getClientRects()[0]},j.prototype.start=function(){var a=this.svg,b=this.vNodes,c=this.vConnections,d=this.getRect(),e=d.width,f=d.height;this.forceLayout=d3.layout.force().gravity(.05).friction(.9).charge(-200).linkDistance(90).linkStrength(function(a){return a.asNEATConnection.enabled}).size([e,f]),this.forceLayout.nodes(b).links(c).start(),this.forceLayout.on("tick",function(){a.select(".connections").selectAll(".connection").attr("d",function(a){return"M"+a.source.x+" "+a.source.y+" "+a.target.x+" "+a.target.y});var b=a.select(".nodes").selectAll(".node").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y});a.select(".labels").selectAll(".label").attr("x",function(a,c){return b[0][c].cx.baseVal.value}).attr("y",function(a,c){return b[0][c].cy.baseVal.value-14})})},j.prototype.refresh=function(){function a(a){return a.asNEATNode instanceof e||a.asNEATNode instanceof f?"#28b62c":a.asNEATNode instanceof g?"#222":"#158cba"}function c(a){return a.asNEATNode instanceof e||a.asNEATNode instanceof f?"#23a127":a.asNEATNode instanceof g?"#111":"#127ba3"}function h(a){return a.asNEATConnection.enabled?"#111":"#aaa"}function i(a){return a.asNEATNode.id}function j(a){return a.asNEATConnection.id}function k(a){return a.asNEATConnection.enabled?"":"5,5"}function l(a){return"url(#"+(a.asNEATConnection.enabled?"enabled":"disabled")+")"}function m(a){return a.asNEATNode.hasChanged?"url(#highlight)":""}function n(a){return a.asNEATConnection.hasChanged?"url(#highlight)":""}var o=this.vNodes,p=this.vConnections,q=this.animateSpeed,r=this.getRect();this.updateVisualizationNetwork(),this.svg.select(".draggableRect").attr("width",r.width).attr("height",r.height);var s=this.forceLayout;s.size([r.width,r.height]),s.start();var t=this.svg.select(".connections").selectAll(".connection").data(p,j);t.enter().append("path").attr("class","connection").style("stroke",h).style("stroke-dasharray",k).attr("marker-end",l).attr("filter",n).on("mouseover",function(a){u.attr("x",(a.target.x+a.source.x)/2).attr("y",(a.target.y+a.source.y)/2);var c=b(a.asNEATConnection.getParameters());v.html(c).style("display","inline-block")}).on("mouseout",function(){v.html("").style("display","none")}),t.transition().duration(q).style("stroke",h).style("stroke-dasharray",k).attr("marker-end",l).attr("filter",n);var u=this.svg.select(".parameterToolTip"),v=u.select("body"),w=(d3.scale.category20(),this.svg.select(".nodes").selectAll(".node").data(o,i));w.enter().append("circle").attr("class","node").attr("r",10).attr("fill",a).attr("stroke",c).attr("filter",m).call(s.drag).on("mouseover",function(a){u.attr("x",a.x).attr("y",a.y);var c=b(a.asNEATNode.getParameters());v.html(c).style("display","inline-block")}).on("mouseout",function(){v.html("").style("display","none")}),w.transition().duration(q).attr("filter",m);this.svg.select(".labels").selectAll(".label").data(o,i).enter().append("text").attr("class","label").text(function(a,b){return d(o[b].asNEATNode.name)})},a["default"]=j}),define("asNEAT/graph",["exports"],function(a){"use strict";var b=require("asNEAT/nodes/outNode")["default"],c=require("asNEAT/utils")["default"].log,d=function(){};d.longestPath=function(a,f){_.forEach(a,function(a){a.cleanParameters()});var g=_.find(a,function(a){return a.asNEATNode instanceof b});c("found outNode: "+g.asNEATNode.toString());var h=[];h=_.union(h,d.getConnectionsGoingTo(g,f));var i=[],j=new e(g);for(g.longestPath=j,g.numHops=j.getLength(),i.push(j);h.length;){var k=h.pop(),l=k.source,m=k.target;if(l.longestPath)c("todo collision");else{var n=m.longestPath;n.isLastNode(m)||(n=n.duplicateFromNode(g)),n.pushNode(l),l.numHops=n.getLength(),l.longestPath=n}h=_.union(h,d.getConnectionsGoingTo(l,f))}var o={};_.forEach(a,function(a){var b=a.getLocalX(),c=o[b];c||(c={value:0},o[b]=c),a.hashElement=c,a.yIndex=c.value++})},d.getConnectionsGoingTo=function(a,b){return _.filter(b,function(b){return b.asNEATConnection.enabled&&b.target===a})};var e=function(a){this.nodes=[],a&&this.pushNode(a)};e.prototype.pushNode=function(a){this.nodes.push(a)},e.prototype.inPath=function(a){return!!_.find(this.nodes,{asNEATNode:a.asNEATNode})},e.prototype.getLength=function(){return this.nodes.length-1},e.prototype.isLastNode=function(a){return this.nodes[this.nodes.length-1]===a},e.prototype.duplicateFromNode=function(a){var b=_.findIndex(this.nodes,function(b){return b.asNEATNode===a.asNEATNode}),c=new e;return c.nodes=this.nodes.slice(0,b+1),c},a["default"]=d}),define("asNEAT/vConnection",["exports"],function(a){"use strict";var b=function(a){_.defaults(this,a,this.defaultParameters)};b.prototype.defaultParameters={inVNode:null,outVNode:null,source:0,target:1,asNEATConnection:null},a["default"]=b}),define("asNEAT/vNode",["exports"],function(a){"use strict";var b=function(a){_.defaults(this,a,this.defaultParameters)};b.prototype.defaultParameters={numHops:0,longestPath:null,yIndex:0,hashElement:null,asNEATNode:null},b.prototype.cleanParameters=function(){this.numHops=0,this.longestPath=null,this.yIndex=0,this.hashElement=null},b.prototype.getLongestPathLength=function(){return this.longestPath?this.longestPath.getLength():1},b.prototype.getNumberNodesInHash=function(){return this.hashElement?this.hashElement.value:1},b.prototype.getLocalX=function(){return 1-this.numHops/this.getLongestPathLength()},b.prototype.getLocalY=function(){return(this.yIndex+1)/(this.getNumberNodesInHash()+1)},b.prototype.getLabel=function(){return"("+this.numHops+"/"+this.getLongestPathLength()+", "+this.yIndex+"/"+this.getNumberNodesInHash()+")"},b.createVNodeFrom=function(a){return new b({asNEATNode:a})},a["default"]=b}),define("asNEAT/visualization",["exports"],function(a){"use strict";var b=require("asNEAT/nodes/oscillatorNode")["default"],c=require("asNEAT/nodes/noteOscillatorNode")["default"],d=require("asNEAT/nodes/outNode")["default"],e=require("asNEAT/vNode")["default"],f=require("asNEAT/vConnection")["default"],g=require("asNEAT/graph")["default"],h=function(a){_.defaults(this,a,this.defaultParameters);var b=d3.select(this.selector).append("svg").attr("width",this.width).attr("height",this.height);b.append("g").attr("class","connections"),b.append("g").attr("class","nodes"),b.append("g").attr("class","labels"),this.svg=b,this.vNodes=[],this.vConnections=[],this.refresh();var c=this,d=window.onresize;window.onresize=function(){c.refresh(),d&&d()}};h.prototype.defaultParameters={network:null,width:"100%",height:600,padding:60,selector:".network",animateSpeed:750},h.prototype.updateVisualizationNetwork=function(){var a=this.vNodes,b=this.vConnections;_.forEach(this.network.nodes,function(b){var c=_.find(a,{asNEATNode:b});c||a.push(e.createVNodeFrom(b))}),_.forEach(this.network.connections,function(c){var d=_.find(b,{asNEATConnection:c});if(!d){var e=_.find(a,{asNEATNode:c.sourceNode}),g=_.find(a,{asNEATNode:c.targetNode});b.push(new f({source:e,target:g,asNEATConnection:c}))}}),g.longestPath(a,b)},h.prototype.refresh=function(){function a(a){return a.getLocalX()*(r-2*t)+t}function e(a){return a.getLocalY()*(s-2*t)+t}function f(a){var b=h(a),c=i(a);return"M"+b+","+c+" C"+b+","+c+" "+b+","+c+" "+b+","+c}function g(a){var b=h(a),c=i(a),d=j(a),e=k(a);return"M"+b+","+c+" C"+(b+v)+","+c+" "+(d-v)+","+e+" "+d+","+e}function h(b){return a(b.source)}function i(a){return e(a.source)}function j(b){return a(b.target)}function k(a){return e(a.target)}function l(a){return a.asNEATNode instanceof b||a.asNEATNode instanceof c?"green":a.asNEATNode instanceof d?"black":"red"}function m(a){return a.asNEATConnection.enabled?"black":"gray"}function n(a){return a.asNEATConnection.id}var o=this.vNodes,p=this.vConnections,q=this.svg[0][0].getClientRects()[0],r=q.width,s=q.height,t=this.padding,u=this.animateSpeed;this.updateVisualizationNetwork();var v=200,w=this.svg.select(".nodes").selectAll(".node").data(o);w.transition().duration(u).attr("cx",a).attr("cy",e).attr("r",10),w.enter().append("circle").attr("class","node").attr("cx",a).attr("cy",e).attr("r",0).attr("stroke","black").attr("stroke-width",2).attr("fill",l).transition().duration(u).attr("r",10);var x=this.svg.select(".connections").selectAll(".connection").data(p,n);x.transition().duration(u).attr("d",g).style("stroke",m),x.enter().append("path").attr("class","connection").attr("d",f).attr("fill","none").style("stroke",m).style("stroke-width",2).transition().duration(u).attr("d",g);var y=this.svg.select(".labels").selectAll(".label").data(o);y.transition().duration(u).attr("x",a).attr("y",e).text(function(a){return a.getLabel()}),y.enter().append("text").attr("class","label").attr("x",a).attr("y",e).style("fill","red").text(function(a){return a.getLabel()})},a["default"]=h});